<html>
<head>
<link rel="stylesheet" type="text/css" href="ComplaintForm.css">
<link rel="stylesheet" type="text/css" href="databaseDisplay.css">
<script src="jquery-3.1.1.min.js"></script>
<script src="ComplaintForm.js"></script>
<script src="ContextMenu.js"></script>
<script src="DatabaseRow.js"></script>
<script src="tableFunctions.js"></script>
<script>
  localStorage.removeItem("lastFormData"); 
	
	var dbSearchCriteria = {};
												 
	var columnIndex = {"prefixAndCaseNumber":0,"plaintiff":1,"defendant":2,"witness":3,"charge":4,"status":5,"hearingDate":6,"verdict":7,"sentence":8,"sentenceStatus":9};
	
	var dataSet = [];
	var rowObjects = [];

	var upArrow = $("<span class='arrow up noPrint'>&#x25B2;</span>");
	var downArrow = $("<span class='arrow down noPrint'>&#x25BC;</span>");

	function getDBInfo(criteria = "all"){
			var returnPromise = new Promise(function(resolve,reject){
			var check = false;
			if(typeof criteria == "object"){
				if(Object.keys(criteria).length == 0)
					criteria = "all"
			}
			
			console.log(criteria);
			
			$.ajax({url:"./returnDBInfo.php",
				method: "GET",
				data:{"criteria": JSON.stringify(criteria)}, 
				success: function(result){
					console.log(result);
					dataSet = JSON.parse(result);
					rowObjects = makeTable(dataSet);
					sortRows();
					fillTable(mainTable.tBodies[0]);
					resolve("Yay");
			}});
		});

		return returnPromise;
	}

	var mainTable;

  $(document).ready(function(){
		mainTable = document.getElementById("mainTable");
		
		simpleHeadingMenuSetup("prefixAndCaseNumber");
		simpleHeadingMenuSetup("plaintiff");
		simpleHeadingMenuSetup("defendant");
		simpleHeadingMenuSetup("witness");
		simpleHeadingMenuSetup("charge");
		simpleHeadingMenuSetup("status");
		simpleHeadingMenuSetup("hearingDate");
		simpleHeadingMenuSetup("verdict");
		simpleHeadingMenuSetup("sentenceStatus");
		
		$("#updateDBButton").click(function(){	
			if(confirm('Are you sure?')){
				for(let i = 0; i < rowObjects.length; i++){
					console.log("SENDING CHANGES");
					rowObjects[i].sendChanges();
				}
			}
		});
		
		getDBInfo();
  
		$("#caseInfoClose").click(function(){
			$(this).parent().hide();
			$(this).siblings().children().remove();
		});
		
		$("html").click(function(){
			$("#contextMenu").hide();
			$(".contextMenuStyle").not("#contextMenu").remove();
			console.log("HIDE TRIGGERED");
		});
  });
</script>
</head>
<body>
<div id="pendingListHeading" style="display: none;">Judicial Committee<br>Pending Cases<br><span class="currentDate"></span></div>
<div id="hearingListHeading" style="display: none;">Judicial Committee<br>Hearing List<br><span class="currentDate"></span></div>
<div id="contextMenu" class="contextMenuStyle noPrint"></div>
<div id="caseInfo" class="noPrint">
  <button id="caseInfoClose">Close</button>
  <div id="caseTarget"></div>
  <div id="scanTarget"></div>
</div>
<div id="currentFilters" class="noPrint"></div>
<button style="float:right; clear: both;" onclick="makeReport('pendingList');" class="noPrint">Print Pending List</button>
<button style="float:right; clear: both;" onclick="makeReport('hearingListDaily');" class="noPrint">Print Daily Hearing List</button>
<button style="float:right; clear: both;" onclick='window.print()' class="noPrint">Print</button>
<button style="float:right; clear: both;" onclick='window.location.href="newComplaint.php"' class="noPrint">Add New Complaint</button>
<button id="updateDBButton" style="float:right;clear:left;" class="noPrint">Update Database</button>
<table id="mainTable" style="margin: auto; clear:both;">
<thead id="mainTableHead">
<tr>
<th>Case No.</th><th>Plaintiff(s)</th><th>Defendant</th><th>Witness(es)</th><th>Charge</th><th class='pndgInvis'>Status</th><th class='pndgInvis'>Hearing Date</th><th class='pndgInvis'>Verdict</th><th class='pndgInvis'>Sentence</th><th class='pndgInvis'>Sentence Status</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</body>
</html>